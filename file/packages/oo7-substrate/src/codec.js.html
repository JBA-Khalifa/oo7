<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">packages/oo7-substrate/src/codec.js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#oo7-parity-src">oo7-parity/src</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7-parity/src/index.js~Bonds.html">Bonds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createBonds">createBonds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isNotOwned">isNotOwned</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isOwned">isOwned</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-bonds">bonds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-options">options</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#oo7-parity-src-abis">oo7-parity/src/abis</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-abiPolyfill">abiPolyfill</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BadgeABI">BadgeABI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BadgeRegABI">BadgeRegABI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-GitHubHintABI">GitHubHintABI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-OperationsABI">OperationsABI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RegistryExtras">RegistryExtras</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TokenABI">TokenABI</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TokenRegABI">TokenRegABI</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#oo7-parity-src-utils">oo7-parity/src/utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-capitalizeFirstLetter">capitalizeFirstLetter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cleanup">cleanup</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-combineValue">combineValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-defDenom">defDenom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-denominationMultiplier">denominationMultiplier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatBalance">formatBalance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatBlockNumber">formatBlockNumber</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatToExponential">formatToExponential</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatValue">formatValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-formatValueNoDenom">formatValueNoDenom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-interpretQuantity">interpretQuantity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-interpretRender">interpretRender</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isAddressValid">isAddressValid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isNullData">isNullData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-removeSigningPrefix">removeSigningPrefix</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sha3">sha3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-singleton">singleton</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-splitSignature">splitSignature</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-splitValue">splitValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-toChecksumAddress">toChecksumAddress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-asciiToHex">asciiToHex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-bytesToHex">bytesToHex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-denominations">denominations</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hexToAscii">hexToAscii</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#oo7-substrate-src">oo7-substrate/src</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7-substrate/src/addressBook.js~AddressBook.html">AddressBook</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7-substrate/src/nodeService.js~NodeService.html">NodeService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7-substrate/src/secretStore.js~SecretStore.html">SecretStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addressBook">addressBook</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nodeService">nodeService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setNodeUri">setNodeUri</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pretty">pretty</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-secretStore">secretStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-composeTransaction">composeTransaction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-post">post</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-metadata">metadata</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#oo7-src">oo7/src</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/bond.js~Bond.html">Bond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/bondCache.js~BondCache.html">BondCache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/bondProxy.js~BondProxy.html">BondProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/defaultBond.js~DefaultBond.html">DefaultBond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/latchBond.js~LatchBond.html">LatchBond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/notReadyBond.js~NotReadyBond.html">NotReadyBond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/reactiveBond.js~ReactiveBond.html">ReactiveBond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/reactivePromise.js~ReactivePromise.html">ReactivePromise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/readyBond.js~ReadyBond.html">ReadyBond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/timeBond.js~TimeBond.html">TimeBond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/oo7/src/transformBond.js~TransformBond.html">TransformBond</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#polkadot-identicon-lib">polkadot-identicon/lib</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/packages/polkadot-identicon/lib/index.js~Identicon.html">Identicon</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">packages/oo7-substrate/src/codec.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const { ss58Decode } = require(&apos;./ss58&apos;)
const { VecU8, AccountId, Hash, VoteThreshold, SlashPreference, Moment, Balance,
	BlockNumber, AccountIndex, Tuple, TransactionEra } = require(&apos;./types&apos;)
const { toLE, leToNumber, bytesToHex } = require(&apos;./utils&apos;)
const metadata = require(&apos;./metadata&apos;)

const transforms = {
	RuntimeMetadata: { outerEvent: &apos;OuterEventMetadata&apos;, modules: &apos;Vec&lt;RuntimeModuleMetadata&gt;&apos; },
	RuntimeModuleMetadata: { prefix: &apos;String&apos;, module: &apos;ModuleMetadata&apos;, storage: &apos;Option&lt;StorageMetadata&gt;&apos; },
	StorageFunctionModifier: { _enum: [ &apos;None&apos;, &apos;Default&apos;, &apos;Required&apos; ] },
	StorageFunctionTypeMap: { key: &apos;Type&apos;, value: &apos;Type&apos; },
	StorageFunctionType: { _enum: { Plain: &apos;Type&apos;, Map: &apos;StorageFunctionTypeMap&apos; } },
	StorageFunctionMetadata: { name: &apos;String&apos;, modifier: &apos;StorageFunctionModifier&apos;, type: &apos;StorageFunctionType&apos;, documentation: &apos;Vec&lt;String&gt;&apos; },
	StorageMetadata: { prefix: &apos;String&apos;, items: &apos;Vec&lt;StorageFunctionMetadata&gt;&apos; },
	EventMetadata: { name: &apos;String&apos;, arguments: &apos;Vec&lt;Type&gt;&apos;, documentation: &apos;Vec&lt;String&gt;&apos; },
	OuterEventMetadata: { name: &apos;String&apos;, events: &apos;Vec&lt;(String, Vec&lt;EventMetadata&gt;)&gt;&apos; },
	ModuleMetadata: { name: &apos;String&apos;, call: &apos;CallMetadata&apos; },
	CallMetadata: { name: &apos;String&apos;, functions: &apos;Vec&lt;FunctionMetadata&gt;&apos; },
	FunctionMetadata: { id: &apos;u16&apos;, name: &apos;String&apos;, arguments: &apos;Vec&lt;FunctionArgumentMetadata&gt;&apos;, documentation: &apos;Vec&lt;String&gt;&apos; },
	FunctionArgumentMetadata: { name: &apos;String&apos;, type: &apos;Type&apos; },

	NewAccountOutcome: { _enum: [ &apos;NoHint&apos;, &apos;GoodHint&apos;, &apos;BadHint&apos; ] },
	UpdateBalanceOutcome: { _enum: [ &apos;Updated&apos;, &apos;AccountKilled&apos; ] },

	Transaction: { version: &apos;u8&apos;, sender: &apos;Address&apos;, signature: &apos;Signature&apos;, index: &apos;Index&apos;, era: &apos;TransactionEra&apos;, call: &apos;Call&apos; },
	Phase: { _enum: { ApplyExtrinsic: &apos;u32&apos;, Finalization: undefined } },
	EventRecord: { phase: &apos;Phase&apos;, event: &apos;Event&apos; }
};

var decodePrefix = 0;

function decode(input, type) {
	if (typeof input.data === &apos;undefined&apos;) {
		input = { data: input };
	}
	if (typeof type === &apos;object&apos;) {
		return type.map(t =&gt; decode(input, t));
	}
	while (type.startsWith(&apos;T::&apos;)) {
		type = type.slice(3);
	}
	if (type == &apos;EventRecord&lt;Event&gt;&apos;) {
		type = &apos;EventRecord&apos;
	}
	
	let dataHex = bytesToHex(input.data.slice(0, 50));
//	console.log(decodePrefix + &apos;des &gt;&gt;&gt;&apos;, type, dataHex);
//	decodePrefix +=  &quot;   &quot;;

	let res;
	let transform = transforms[type];
	if (transform) {
		if (typeof transform == &apos;string&apos;) {
			res = decode(input, transform);
		} else if (typeof transform == &apos;object&apos;) {
			if (transform instanceof Array) {
				// just a tuple
				res = new Tuple(...decode(input, transform));
			} else if (!transform._enum) {
				// a struct
				res = {};
				Object.keys(transform).forEach(k =&gt; {
					res[k] = decode(input, transform[k]);
				});
			} else if (transform._enum instanceof Array) {
				// simple enum
				let n = input.data[0];
				input.data = input.data.slice(1);
				res = { option: transform._enum[n] };
			} else if (transform._enum) {
				// enum
				let n = input.data[0];
				input.data = input.data.slice(1);
				let option = Object.keys(transform._enum)[n];
				res = { option, value: typeof transform._enum[option] === &apos;undefined&apos; ? undefined : decode(input, transform._enum[option]) };
			}
		}
		res._type = type;
	} else {
		switch (type) {
/*			case &apos;Call&apos;:
			case &apos;Proposal&apos;: {
				let c = Calls[input.data[0]];
				res = type === &apos;Call&apos; ? new Call : new Proposal;
				res.module = c.name;
				c = c[type == &apos;Call&apos; ? &apos;calls&apos; : &apos;priv_calls&apos;][input.data[1]];
				input.data = input.data.slice(2);
				res.name = c.name;
				res.params = c.params.map(p =&gt; ({ name: p.name, type: p.type, value: decode(input, p.type) }));
				break;
			}*/
			case &apos;Event&apos;: {
				let events = metadata.outerEvent.events
				let moduleIndex = decode(input, &apos;u8&apos;)
				let module = events[moduleIndex][0]
				let eventIndex = decode(input, &apos;u8&apos;)
				let name = events[moduleIndex][1][eventIndex].name
				let args = decode(input, events[moduleIndex][1][eventIndex].arguments)
				res = { _type: &apos;Event&apos;, module, name, args }
				break
			}
			case &apos;AccountId&apos;: {
				res = new AccountId(input.data.slice(0, 32));
				input.data = input.data.slice(32);
				break;
			}
			case &apos;Hash&apos;: {
				res = new Hash(input.data.slice(0, 32));
				input.data = input.data.slice(32);
				break;
			}
			case &apos;Balance&apos;: {
				res = leToNumber(input.data.slice(0, 16));
				input.data = input.data.slice(16);
				res = new Balance(res);
				break;
			}
			case &apos;BlockNumber&apos;: {
				res = leToNumber(input.data.slice(0, 8));
				input.data = input.data.slice(8);
				res = new BlockNumber(res);
				break;
			}
			case &apos;AccountIndex&apos;: {
				res = leToNumber(input.data.slice(0, 4));
				input.data = input.data.slice(4);
				res = new AccountIndex(res);
				break;
			}
			case &apos;Moment&apos;: {
				let n = leToNumber(input.data.slice(0, 8));
				input.data = input.data.slice(8);
				res = new Moment(n);
				break;
			}
			case &apos;VoteThreshold&apos;: {
				const VOTE_THRESHOLD = [&apos;SuperMajorityApprove&apos;, &apos;NotSuperMajorityAgainst&apos;, &apos;SimpleMajority&apos;];
				res = new VoteThreshold(VOTE_THRESHOLD[input.data[0]]);
				input.data = input.data.slice(1);
				break;
			}
			case &apos;SlashPreference&apos;: {
				res = new SlashPreference(decode(input, &apos;u32&apos;));
				break;
			}
			case &apos;Compact&lt;u128&gt;&apos;:
			case &apos;Compact&lt;u64&gt;&apos;:
			case &apos;Compact&lt;u32&gt;&apos;:
			case &apos;Compact&lt;u16&gt;&apos;:
			case &apos;Compact&lt;u8&gt;&apos;: {
				let len;
				if (input.data[0] % 4 == 0) {
					// one byte
					res = input.data[0] &gt;&gt; 2;
					len = 1;
				} else if (input.data[0] % 4 == 1) {
					res = leToNumber(input.data.slice(0, 2)) &gt;&gt; 2;
					len = 2;
				} else if (input.data[0] % 4 == 2) {
					res = leToNumber(inpuzt.data.slice(0, 4)) &gt;&gt; 2;
					len = 4;
				} else {
					let n = (input.data[0] &gt;&gt; 2) + 4;
					res = leToNumber(input.data.slice(1, n + 1));
					len = 5 + n;
				}
				input.data = input.data.slice(len);
				break;
			}
			case &apos;u8&apos;:
				res = leToNumber(input.data.slice(0, 1));
				input.data = input.data.slice(1);
				break;
			case &apos;u16&apos;:
				res = leToNumber(input.data.slice(0, 2));
				input.data = input.data.slice(2);
				break;
			case &apos;u32&apos;:
			case &apos;VoteIndex&apos;:
			case &apos;PropIndex&apos;:
			case &apos;ReferendumIndex&apos;: {
				res = leToNumber(input.data.slice(0, 4));
				input.data = input.data.slice(4);
				break;
			}
			case &apos;u64&apos;:
			case &apos;Index&apos;: {
				res = leToNumber(input.data.slice(0, 8));
				input.data = input.data.slice(8);
				break;
			}
			case &apos;bool&apos;: {
				res = !!input.data[0];
				input.data = input.data.slice(1);
				break;
			}
			case &apos;KeyValue&apos;: {
				res = decode(input, &apos;(Vec&lt;u8&gt;, Vec&lt;u8&gt;)&apos;);
				break;
			}
			case &apos;Vec&lt;bool&gt;&apos;: {
				let size = decode(input, &apos;Compact&lt;u32&gt;&apos;);
				res = [...input.data.slice(0, size)].map(a =&gt; !!a);
				input.data = input.data.slice(size);
				break;
			}
			case &apos;Vec&lt;u8&gt;&apos;: {
				let size = decode(input, &apos;Compact&lt;u32&gt;&apos;);
				res = input.data.slice(0, size);
				input.data = input.data.slice(size);
				break;
			}
			case &apos;String&apos;: {
				let size = decode(input, &apos;Compact&lt;u32&gt;&apos;);
				res = input.data.slice(0, size);
				input.data = input.data.slice(size);
				res = new TextDecoder(&quot;utf-8&quot;).decode(res);
				break;
			}
			case &apos;Type&apos;: {
				res = decode(input, &apos;String&apos;);
				while (res.indexOf(&apos;T::&apos;) != -1) {
					res = res.replace(&apos;T::&apos;, &apos;&apos;);
				}
				res = res.match(/^Box&lt;.*&gt;$/) ? res.slice(4, -1) : res;
				break;
			}
			default: {
				let v = type.match(/^Vec&lt;(.*)&gt;$/);
				if (v) {
					let size = decode(input, &apos;Compact&lt;u32&gt;&apos;);
					res = [...new Array(size)].map(() =&gt; decode(input, v[1]));
					break;
				}
				let o = type.match(/^Option&lt;(.*)&gt;$/);
				if (o) {
					let some = decode(input, &apos;bool&apos;);
					if (some) {
						res = decode(input, o[1]);
					} else {
						res = null;
					}
					break;
				}
				let t = type.match(/^\((.*)\)$/);
				if (t) {
					res = new Tuple(...decode(input, t[1].split(&apos;, &apos;)));
					break;
				}
				throw &apos;Unknown type to decode: &apos; + type;
			}
		}
	}
//	decodePrefix = decodePrefix.substr(3);
//	console.log(decodePrefix + &apos;des &lt;&lt;&lt;&apos;, type, res);
	return res;
}

function encode(value, type = null) {
	// if an array then just concat
	if (type instanceof Array) {
		if (value instanceof Array) {
			let x = value.map((i, index) =&gt; encode(i, type[index]));
			let res = new Uint8Array();
			x.forEach(x =&gt; {
				r = new Uint8Array(res.length + x.length);
				r.set(res)
				r.set(x, res.length)
				res = r
			})
			return res
		} else {
			throw &apos;If type is array, value must be too&apos;
		}
	}
	if (typeof value == &apos;object&apos; &amp;&amp; !type &amp;&amp; value._type) {
		type = value._type
	}
	if (typeof type != &apos;string&apos;) {
		throw &apos;type must be either an array or a string&apos;
	}

	if (typeof value == &apos;string&apos; &amp;&amp; value.startsWith(&apos;0x&apos;)) {
		value = hexToBytes(value)
	}

	if (transforms[type]) {
		let transform = transforms[type]
		if (transform instanceof Array) {
			// just a tuple
			return encode(value, transform)
		} else if (!transform._enum) {
			// a struct
			let keys = []
			let types = []
			Object.keys(transform).forEach(k =&gt; {
				keys.push(value[k])
				types.push(transform[k])
			})
			return encode(keys, types)
		} else if (transform._enum instanceof Array) {
			// simple enum
			return new Uint8Array([transform._enum.indexOf(value.option)])
		} else if (transform._enum) {
			// enum
			let index = Object.keys(transform._enum).indexOf(value.option)
			let value = encode(value.value, transform._enum[value.option])
			return new Uint8Array([index, ...value])
		}
	}

	// other type-specific transforms
	if (type == &apos;Vec&lt;u8&gt;&apos;) {
		if (typeof value == &apos;object&apos; &amp;&amp; value instanceof Uint8Array) {
			return new Uint8Array([...encode(value.length, &apos;Compact&lt;u32&gt;&apos;), ...value])
		}
	}

	if (type == &apos;Address&apos; || type == &apos;RawAddress&lt;AccountId, AccountIndex&gt;&apos; || type == &apos;Address&lt;AccountId, AccountIndex&gt;&apos;) {
		if (typeof value == &apos;string&apos;) {
			value = ss58Decode(value)
		}
		if (typeof value == &apos;object&apos; &amp;&amp; value instanceof Uint8Array &amp;&amp; value.length == 32) {
			return new Uint8Array([0xff, ...value])
		}
		if (typeof value == &apos;number&apos; || value instanceof AccountIndex) {
			if (value &lt; 0xf0) {
				return new Uint8Array([value])
			} else if (value &lt; 1 &lt;&lt; 16) {
				return new Uint8Array([0xfc, ...toLE(value, 2)])
			} else if (value &lt; 1 &lt;&lt; 32) {
				return new Uint8Array([0xfd, ...toLE(value, 4)])
			} else if (value &lt; 1 &lt;&lt; 64) {
				return new Uint8Array([0xfe, ...toLE(value, 8)])
			}
		}
	}

	if (type == &apos;AccountId&apos;) {
		if (typeof value == &apos;string&apos;) {
			return ss58Decode(value);
		}
		if (value instanceof Uint8Array &amp;&amp; value.length == 32) {
			return value
		}
	}

	if (typeof value == &apos;number&apos;) {
		switch (type) {
			case &apos;Balance&apos;:
			case &apos;u128&apos;:
				return toLE(value, 16)
			case &apos;Index&apos;:
			case &apos;u64&apos;:
			return toLE(value, 8)
			case &apos;AccountIndex&apos;:
			case &apos;u32&apos;:
				return toLE(value, 4)
			case &apos;u16&apos;:
				return toLE(value, 2)
			case &apos;u8&apos;:
				return toLE(value, 1)
			default:
				break
		}
	}

	if (value instanceof AccountIndex &amp;&amp; type == &apos;AccountIndex&apos;) {
		return toLE(value, 4)
	}

	if (value instanceof Uint8Array) {
		if (type == &apos;Signature&apos; &amp;&amp; value.length == 64) {
			return value
		}
		if (type == &apos;Hash&apos; &amp;&amp; value.length == 32) {
			return value
		}
	}

	if (type == &apos;TransactionEra&apos; &amp;&amp; value instanceof TransactionEra) {
		return value.encode()
	} else if (type == &apos;TransactionEra&apos;) {
		console.error(&quot;TxEra::encode bad&quot;, type, value)
	}
	
	if (type.match(/^Compact&lt;u[0-9]*&gt;$/)) {
		if (value &lt; 1 &lt;&lt; 6) {
			return new Uint8Array([value &lt;&lt; 2])
		} else if (value &lt; 1 &lt;&lt; 14) {
			return toLE((value &lt;&lt; 2) + 1, 2)
		} else if (value &lt; 1 &lt;&lt; 30) {
			return toLE((value &lt;&lt; 2) + 2, 4)
		} else {
			var v = [3, ...toLE(value, 4)]
			let n = value &gt;&gt; 32
			while (n &gt; 0) {
				v[0]++
				v.push(n % 256)
				n &gt;&gt;= 8
			}
			return new Uint8Array(v)
		}
	}

	if (type == &apos;bool&apos;) {
		return new Uint8Array([value ? 1 : 0])
	}

	if (typeof type == &apos;string&apos; &amp;&amp; type.match(/\(.*\)/)) {
		return encode(value, type.substr(1, type.length - 2).split(&apos;,&apos;))
	}

	// Maybe it&apos;s pre-encoded?
	if (typeof value == &apos;object&apos; &amp;&amp; value instanceof Uint8Array) {
		switch (type) {
			case &apos;Call&apos;:
				break
			default:
				console.warn(`Value passed apparently pre-encoded without whitelisting ${type}`)
		}
		return value
	}

	throw `Value cannot be encoded as type: ${value}, ${type}`
}

module.exports = { decode, encode }</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
